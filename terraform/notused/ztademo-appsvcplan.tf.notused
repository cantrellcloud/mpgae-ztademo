#================================================================================
#
# OPENFIRE : POLICY ENFORCEMENT POINT : POLICY CONTROLLER
#
# Policy Enforcement Point for the popular Openfire Chat Server application.
# Used in a DataCentric Environment built on the principal of Attribute Based
# Access Control and Zero-Trust methodologies.
#
# This application was developed using the Policy Controller for Java and
# Nextlabs Java SDK.  In addition, the Policy Controller for Java is only
# compatible with the NextLabs Java SDK
#
# Java/Tomcat 8.5 Web Application Service
# Azure App Service Plan
#-----------------------
# OFEnforcer PEP
# EmbeddedPDP
#

# appsvcplan01
module "kea_dcedemo_eastus_abac_appsvcplan" {
	source = "github.com/cantrellcloud/tfAzureModules/appsvcplan"
	#to_provision = local.provision_appsvcplan01
	rg_location = module.kea_dcedemo_eastus_abac_appsvcplan_rg.rg_location
	rg_name = module.kea_dcedemo_eastus_abac_appsvcplan_rg.rg_name

	appsvcplan_name = "kea_dcedemo_eastus_abac_appsvcplan"
    kind = "Linux"
    reserved = true
    is_xenon = false

    #sku
        sku_tier = "Basic"
        sku_size = "B2"
        #sku_capacity = 4
}

   #appsvcplan01_outputs
   output "kea_dcedemo_eastus_abac_appsvcplan_id" {
        value = module.kea_dcedemo_eastus_abac_appsvcplan.appsvcplan_id
    }
    output "kea_dcedemo_eastus_abac_appsvcplan_name" {
        value = module.kea_dcedemo_eastus_abac_appsvcplan.appsvcplan_name
    }
    output "kea_dcedemo_eastus_abac_appsvcplan_kind" {
        value = module.kea_dcedemo_eastus_abac_appsvcplan.appsvcplan_kind
    }
    output "kea_dcedemo_eastus_abac_appsvcplan_appsvcplan_maximum_number_of_workers" {
        value = module.kea_dcedemo_eastus_abac_appsvcplan.appsvcplan_maximum_number_of_workers
    }

    #appsvc01
    module "kea_dcedemo_eastus_abac_appsvcplan_ofembedpep_appsvc" {
        source = "github.com/cantrellcloud/tfAzureModules/appsvc"
        #to_provision = local.provision_appsvc01
        rg_location = module.kea_dcedemo_eastus_abac_appsvcplan_rg.rg_location
        rg_name = module.kea_dcedemo_eastus_abac_appsvcplan_rg.rg_name
        appsvc_name = "ofembedpep"
        appsvcplan_id = module.kea_dcedemo_eastus_abac_appsvcplan.appsvcplan_id

        #site_config
        site_config_always_on                   = true
        site_config_dotnet_framework_version    = "v4.0"
        site_config_ftps_state                  = "FtpsOnly"
        site_config_http2_enabled               = false
        #site_config_ip_restriction              = 
        site_config_linux_fx_version            = "TOMCAT|8.5-jre8"
        #site_config_windows_fx_version            = "TOMCAT|8.5-jre8"
        site_config_local_mysql_enabled         = true
        #site_config_managed_pipeline_mode       = 
        #site_config_min_tls_version             = 
        #site_config_number_of_workers           = 
        site_config_remote_debugging_enabled    = false
        #site_config_remote_debugging_version     = 
        #site_config_scm_ip_restriction          = 
        site_config_scm_type                    = "LocalGit"
        #site_config_scm_use_main_ip_restriction = false
        site_config_websockets_enabled          = true

        #connection_string
        connection_string_name  = "ofembedpepdb"
        connection_string_type  = "MySQL"
        connection_string_value = "Server=ofembedpepdb;Integrated Security=SSPI"
    }

        #appsvc01_outputs
        output "kea_dcedemo_eastus_abac_appsvcplan_ofembedpep_appsvc_id" {
            value = module.kea_dcedemo_eastus_abac_appsvcplan_ofembedpep_appsvc.appsvc_id
        }
        output "kea_dcedemo_eastus_abac_appsvcplan_ofembedpep_appsvc_name" {
            value = module.kea_dcedemo_eastus_abac_appsvcplan_ofembedpep_appsvc.appsvc_name
        }
        output "kea_dcedemo_eastus_abac_appsvcplan_ofembedpep_appsvc_default_site_hostname" {
            value = module.kea_dcedemo_eastus_abac_appsvcplan_ofembedpep_appsvc.appsvc_default_site_hostname
        }
        output "kea_dcedemo_eastus_abac_appsvcplan_ofembedpep_appsvc_custom_domain_verification_id" {
            value = module.kea_dcedemo_eastus_abac_appsvcplan_ofembedpep_appsvc.appsvc_custom_domain_verification_id
        }
        output "kea_dcedemo_eastus_abac_appsvcplan_ofembedpep_appsvc_source_control" {
            value = module.kea_dcedemo_eastus_abac_appsvcplan_ofembedpep_appsvc.appsvc_source_control
        }
        output "kea_dcedemo_eastus_abac_appsvcplan_ofembedpep_appsvc_site_credential" {
            value = module.kea_dcedemo_eastus_abac_appsvcplan_ofembedpep_appsvc.appsvc_site_credential
        }
        output "kea_dcedemo_eastus_abac_appsvcplan_ofembedpep_appsvc_identity" {
            value = module.kea_dcedemo_eastus_abac_appsvcplan_ofembedpep_appsvc.appsvc_identity
        }

    #appsvc02
    module "kea_dcedemo_eastus_abac_appsvcplan_ztcontroller_appsvc" {
        source = "github.com/cantrellcloud/tfAzureModules/appsvc"
        #to_provision = local.provision_appsvc02
        rg_location = module.kea_dcedemo_eastus_abac_appsvcplan_rg.rg_location
        rg_name = module.kea_dcedemo_eastus_abac_appsvcplan_rg.rg_name
        appsvc_name = "ztcontroller"
        appsvcplan_id = module.kea_dcedemo_eastus_abac_appsvcplan.appsvcplan_id

        #site_config
        site_config_always_on                   = true
        site_config_dotnet_framework_version    = "v4.0"
        site_config_ftps_state                  = "FtpsOnly"
        site_config_http2_enabled               = false
        #site_config_ip_restriction              = 
        site_config_linux_fx_version            = "TOMCAT|8.5-jre8"
        site_config_local_mysql_enabled         = true
        #site_config_managed_pipeline_mode       = 
        #site_config_min_tls_version             = 
        #site_config_number_of_workers           = 
        site_config_remote_debugging_enabled    = false
        #site_config_remote_debugging_version    = 
        #site_config_scm_ip_restriction          = 
        site_config_scm_type                    = "LocalGit"
        #site_config_scm_use_main_ip_restriction = false
        site_config_websockets_enabled          = true

        #connection_string
        connection_string_name  = "ztcontrollerdb"
        connection_string_type  = "MySQL"
        connection_string_value = "Server=ztcontrollerdb;Integrated Security=SSPI"
    }

        #appsvc02_outputs
        output "kea_dcedemo_eastus_abac_appsvcplan_ztcontroller_appsvc_id" {
            value = module.kea_dcedemo_eastus_abac_appsvcplan_ztcontroller_appsvc.appsvc_id
        }
        output "kea_dcedemo_eastus_abac_appsvcplan_ztcontroller_appsvc_name" {
            value = module.kea_dcedemo_eastus_abac_appsvcplan_ztcontroller_appsvc.appsvc_name
        }
        output "kea_dcedemo_eastus_abac_appsvcplan_ztcontroller_appsvc_default_site_hostname" {
            value = module.kea_dcedemo_eastus_abac_appsvcplan_ztcontroller_appsvc.appsvc_default_site_hostname
        }
        output "kea_dcedemo_eastus_abac_appsvcplan_ztcontroller_appsvc_custom_domain_verification_id" {
            value = module.kea_dcedemo_eastus_abac_appsvcplan_ztcontroller_appsvc.appsvc_custom_domain_verification_id
        }
        output "kea_dcedemo_eastus_abac_appsvcplan_ztcontroller_appsvc_source_control" {
            value = module.kea_dcedemo_eastus_abac_appsvcplan_ztcontroller_appsvc.appsvc_source_control
        }
        output "kea_dcedemo_eastus_abac_appsvcplan_ztcontroller_appsvc_site_credential" {
            value = module.kea_dcedemo_eastus_abac_appsvcplan_ztcontroller_appsvc.appsvc_site_credential
        }
        output "kea_dcedemo_eastus_abac_appsvcplan_ztcontroller_appsvc_identity" {
            value = module.kea_dcedemo_eastus_abac_appsvcplan_ztcontroller_appsvc.appsvc_identity
        }
